# ADR-006: CSV Files for ML Scores Instead of Database/API

## Status
Accepted

## Context
We need to display ML-generated company adoption scores and technical fit scores in the frontend:
- **Company adoption scores**: `waps_score_percentile` (0-100) for companies
- **Technical fit scores**: Vessel-level scores for wind propulsion retrofit suitability
- **Data source**: Generated by ML pipeline (Python scripts, not part of main app)
- **Update frequency**: Infrequent (when ML model is retrained or new data processed)
- **Data size**: ~52 companies, ~1700 vessels (relatively small datasets)

The ML pipeline generates CSV files, and we need to decide how to serve this data to the frontend.

## Decision
We serve ML scores via **CSV files** stored in `frontend/public/data/` and loaded directly by the frontend.

### Implementation Details:
- CSV files:
  - `companies_with_waps_score.csv` - Company adoption scores (52 companies)
  - `technical_fit_ships.csv` - Vessel technical fit scores (~1700 vessels)
- Frontend loading: Uses `loadCSV()` utility function that fetches and parses CSV
- Path resolution: Uses `import.meta.env.BASE_URL` to handle `/ships/` prefix
- Flask route: Serves CSV files from `frontend/public/data/` via `/ships/data/*` route
- No database storage: CSVs are not imported into SQLite database
- No API endpoint: Frontend loads CSVs directly, no backend processing needed

## Consequences

### Positive:
- ✅ **Simple deployment** - Just copy CSV files to VPS, no database migration needed
- ✅ **Version control friendly** - CSV files can be committed to git (if not too large)
- ✅ **Easy updates** - Replace CSV file to update scores, no database queries
- ✅ **Frontend independence** - Frontend can load data without backend API calls
- ✅ **ML pipeline independence** - ML scripts generate CSVs, no need to integrate with Flask app
- ✅ **Fast loading** - Direct file access, no database query overhead
- ✅ **Human readable** - CSV files can be inspected/edited manually if needed

### Negative:
- ❌ **No real-time updates** - Must rebuild/redeploy to update scores
- ❌ **File management** - Must manually copy files to VPS (could be automated)
- ❌ **No querying** - Can't filter/sort server-side, must load all data
- ❌ **No versioning** - No history of score changes (could add timestamps to filenames)
- ❌ **Path complexity** - Must handle `/ships/` prefix correctly

### Trade-offs:
- **Simplicity over features**: CSV files are simpler than database, but less flexible
- **Static over dynamic**: Accepting that scores don't update in real-time
- **File-based over API**: Easier deployment but less programmatic access

## Alternatives Considered

### Store in SQLite database
- **Pros**: Can query/filter server-side, version history, real-time updates possible
- **Cons**: Requires database migration, ML pipeline must integrate with Flask app
- **Rejected**: ML pipeline is separate, CSV files are simpler for infrequent updates

### REST API endpoint
- **Pros**: Can filter/sort server-side, standard API pattern
- **Cons**: Requires backend code to read CSV/DB, more complexity
- **Rejected**: No need for server-side filtering, frontend can handle it

### JSON files instead of CSV
- **Pros**: Native JavaScript format, easier parsing
- **Cons**: Less human-readable, larger file size
- **Rejected**: CSV is more standard for tabular data, easier to edit

## Implementation Details

### CSV Structure
`companies_with_waps_score.csv`:
- Columns: `company_name`, `waps_score_percentile`, `waps_adopted`, `waps_adoption_score`, etc.
- 52 rows (one per company)

`technical_fit_ships.csv`:
- Columns: `MMSI`, `Name`, `Type`, `Length`, `Flag`, `Company`, `CO2`, `Technical Fit`
- ~1700 rows (one per vessel)

### Frontend Loading
```javascript
// TargetVessels.jsx
const techRows = await loadCSV(`${import.meta.env.BASE_URL}data/technical_fit_ships.csv`);
const mlRows = await loadCSV(`${import.meta.env.BASE_URL}data/companies_with_waps_score.csv`);
```

### Flask Route
```python
# web_tracker.py
@app.route('/ships/<path:path>')
def serve_frontend(path):
    if path.startswith('data/'):
        data_file = project_root / 'frontend' / 'public' / path
        if data_file.exists():
            return send_from_directory(str(data_file.parent), data_file.name)
```

## Related ADRs
- ADR-003: React frontend (loads CSV files)
- ADR-002: Flask backend (serves CSV files)

## References
- Implementation: `frontend/src/pages/TargetVessels.jsx`, `frontend/src/utils/loadCSV.js`
- Flask route: `src/services/web_tracker.py` lines 400-409

