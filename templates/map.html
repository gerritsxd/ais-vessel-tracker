<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Vessel Tracker</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
        }
        
        #header {
            background: #16213e;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        #header h1 {
            font-size: 24px;
            color: #00d4ff;
        }
        
        #stats {
            display: flex;
            gap: 30px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #00d4ff;
        }
        
        .stat-label {
            font-size: 12px;
            color: #aaa;
            text-transform: uppercase;
        }
        
        #controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-group label {
            font-size: 12px;
            color: #aaa;
        }
        
        .filter-group select {
            background: #0f3460;
            color: #eee;
            border: 1px solid #00d4ff;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        #map {
            height: calc(100vh - 120px);
            width: calc(100% - 400px);
            position: relative;
            float: left;
        }
        
        /* Sidebar Panel */
        #sidebar {
            width: 400px;
            height: calc(100vh - 120px);
            background: #16213e;
            float: right;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0,0,0,0.3);
            padding: 20px;
            display: none;
        }
        
        #sidebar.active {
            display: block;
        }
        
        #sidebar h2 {
            color: #00d4ff;
            font-size: 20px;
            margin-bottom: 15px;
            border-bottom: 2px solid #00d4ff;
            padding-bottom: 10px;
        }
        
        #sidebar .close-btn {
            float: right;
            background: #ff0000;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        #sidebar .close-btn:hover {
            background: #cc0000;
        }
        
        #sidebar .info-section {
            margin-bottom: 20px;
            background: #0f3460;
            padding: 15px;
            border-radius: 8px;
        }
        
        #sidebar .info-section h3 {
            color: #00d4ff;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        #sidebar .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #1a1a2e;
        }
        
        #sidebar .info-row:last-child {
            border-bottom: none;
        }
        
        #sidebar .info-label {
            color: #aaa;
            font-size: 13px;
        }
        
        #sidebar .info-value {
            color: #fff;
            font-size: 13px;
            font-weight: bold;
        }
        
        /* Legend */
        .legend {
            position: absolute;
            bottom: 30px;
            right: 10px;
            background: rgba(22, 33, 62, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 1000;
            min-width: 200px;
        }
        
        .legend h3 {
            color: #00d4ff;
            font-size: 14px;
            margin-bottom: 10px;
            border-bottom: 1px solid #00d4ff;
            padding-bottom: 5px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            font-size: 12px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #fff;
        }
        
        .legend-size {
            font-size: 11px;
            color: #aaa;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #444;
        }
        
        /* Enhanced Popup */
        .vessel-popup {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-width: 300px;
        }
        
        .vessel-popup h3 {
            margin: 0 0 10px 0;
            color: #00d4ff;
            font-size: 18px;
            border-bottom: 2px solid #00d4ff;
            padding-bottom: 5px;
        }
        
        .vessel-photo {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .vessel-photo-placeholder {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
        }
        
        .vessel-popup table {
            width: 100%;
            font-size: 13px;
        }
        
        .vessel-popup td {
            padding: 4px 5px;
            vertical-align: top;
        }
        
        .vessel-popup td:first-child {
            font-weight: bold;
            color: #666;
            width: 100px;
        }
        
        .vessel-popup .ship-type-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .type-passenger { background: #ff00ff; color: white; }
        .type-cargo { background: #00ff00; color: black; }
        .type-tanker { background: #ff0000; color: white; }
        .type-other { background: #00d4ff; color: black; }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-active {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        
        .status-inactive {
            background: #666;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>üö¢ Real-Time Vessel Tracker</h1>
        
        <div style="display: flex; gap: 10px;">
            <a href="/ships/fleet-visualization" class="btn" style="background: #0f3460; color: #00d4ff; border: 1px solid #00d4ff; padding: 8px 16px; border-radius: 4px; text-decoration: none; font-size: 14px; transition: all 0.3s;">üåê 3D Fleet</a>
            <a href="/ships/sql" class="btn" style="background: #0f3460; color: #00d4ff; border: 1px solid #00d4ff; padding: 8px 16px; border-radius: 4px; text-decoration: none; font-size: 14px; transition: all 0.3s;">üíª SQL Query</a>
            <a href="/ships/database" class="btn" style="background: #0f3460; color: #00d4ff; border: 1px solid #00d4ff; padding: 8px 16px; border-radius: 4px; text-decoration: none; font-size: 14px; transition: all 0.3s;">üóÑÔ∏è Database</a>
        </div>
        
        <div id="controls">
            <div class="filter-group">
                <label>Type:</label>
                <select id="filter-type">
                    <option value="all">All Types</option>
                    <option value="60">Passenger</option>
                    <option value="70">Cargo</option>
                    <option value="80">Tanker</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Size:</label>
                <select id="filter-size">
                    <option value="all">All Sizes</option>
                    <option value="large">Large (‚â•200m)</option>
                    <option value="medium">Medium (100-200m)</option>
                </select>
            </div>
        </div>
        
        <div id="stats">
            <div class="stat">
                <div class="stat-value" id="total-vessels">0</div>
                <div class="stat-label">Total Vessels</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="active-vessels">0</div>
                <div class="stat-label">Active Tracking</div>
            </div>
            <div class="stat">
                <div class="stat-label">
                    <span class="status-indicator status-active"></span>
                    Live Updates
                </div>
            </div>
        </div>
    </div>
    
    <div id="map">
        <div class="legend">
            <h3>Legend</h3>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff00ff;"></div>
                <span>Passenger Ships</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #00ff00;"></div>
                <span>Cargo Ships</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff0000;"></div>
                <span>Tankers</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #00d4ff;"></div>
                <span>Other Vessels</span>
            </div>
            <div class="legend-size">
                <strong>Size:</strong><br>
                ‚Ä¢ Large dot = ‚â•200m<br>
                ‚Ä¢ Small dot = 100-200m
            </div>
        </div>
    </div>
    
    <div id="sidebar">
        <button class="close-btn" onclick="closeSidebar()">‚úï Close</button>
        <h2 id="sidebar-title">Vessel Details</h2>
        <div id="sidebar-content"></div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <script>
        // Initialize map
        const map = L.map('map').setView([51.5, 2], 7);
        
        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);
        
        // Store markers and vessel data
        const markers = {};
        let allVessels = [];
        let currentFilters = {
            type: 'all',
            size: 'all'
        };
        let currentRoute = null; // Store current route polyline
        
        // Ship type colors and names
        const shipTypeInfo = {
            60: { color: '#ff00ff', name: 'Passenger', badge: 'type-passenger' },
            70: { color: '#00ff00', name: 'Cargo', badge: 'type-cargo' },
            80: { color: '#ff0000', name: 'Tanker', badge: 'type-tanker' },
            default: { color: '#00d4ff', name: 'Other', badge: 'type-other' }
        };
        
        function getShipTypeInfo(shipType) {
            if (shipType >= 60 && shipType < 70) return shipTypeInfo[60];
            if (shipType >= 70 && shipType < 80) return shipTypeInfo[70];
            if (shipType >= 80 && shipType < 90) return shipTypeInfo[80];
            return shipTypeInfo.default;
        }
        
        // Create custom icon
        function createVesselIcon(vessel) {
            const isLarge = vessel.length >= 200;
            const typeInfo = getShipTypeInfo(vessel.ship_type);
            const color = typeInfo.color;
            
            return L.divIcon({
                className: 'custom-marker',
                html: `<div style="background: ${color}; border: 2px solid #fff; border-radius: 50%; width: ${isLarge ? 16 : 12}px; height: ${isLarge ? 16 : 12}px; box-shadow: 0 0 ${isLarge ? 15 : 10}px ${color};"></div>`,
                iconSize: [isLarge ? 16 : 12, isLarge ? 16 : 12],
                iconAnchor: [isLarge ? 8 : 6, isLarge ? 8 : 6]
            });
        }
        
        // Create enhanced popup content with ship photo
        function createPopupContent(mmsi, vessel) {
            const hasPosition = vessel.lat !== undefined;
            const typeInfo = getShipTypeInfo(vessel.ship_type);
            
            // Try to get ship photo from MarineTraffic (note: this is a placeholder, actual API requires key)
            const photoUrl = `https://photos.marinetraffic.com/ais/showphoto.aspx?mmsi=${mmsi}`;
            
            return `
                <div class="vessel-popup">
                    <h3>${vessel.name}</h3>
                    <div class="vessel-photo-placeholder">üö¢</div>
                    <span class="ship-type-badge ${typeInfo.badge}">${typeInfo.name}</span>
                    <table>
                        <tr><td>MMSI:</td><td>${mmsi}</td></tr>
                        <tr><td>Flag:</td><td>${vessel.flag_state || 'Unknown'}</td></tr>
                        <tr><td>Length:</td><td>${vessel.length}m</td></tr>
                        <tr><td>Type Code:</td><td>${vessel.ship_type || 'N/A'}</td></tr>
                        ${vessel.imo ? `<tr><td>IMO:</td><td>${vessel.imo}</td></tr>` : ''}
                        ${vessel.call_sign ? `<tr><td>Call Sign:</td><td>${vessel.call_sign}</td></tr>` : ''}
                        ${hasPosition ? `
                            <tr><td>Position:</td><td>${vessel.lat.toFixed(4)}¬∞N, ${vessel.lon.toFixed(4)}¬∞E</td></tr>
                            <tr><td>Speed:</td><td>${vessel.sog} knots</td></tr>
                            <tr><td>Course:</td><td>${vessel.cog}¬∞</td></tr>
                            <tr><td>Updated:</td><td>${new Date(vessel.timestamp).toLocaleString()}</td></tr>
                        ` : '<tr><td colspan="2"><em>Waiting for position...</em></td></tr>'}
                    </table>
                </div>
            `;
        }
        
        // Check if vessel passes filters
        function passesFilters(vessel) {
            // Type filter
            if (currentFilters.type !== 'all') {
                if (currentFilters.type === 'other') {
                    if (vessel.ship_type >= 60 && vessel.ship_type < 90) return false;
                } else {
                    const typeNum = parseInt(currentFilters.type);
                    if (!vessel.ship_type || vessel.ship_type < typeNum || vessel.ship_type >= typeNum + 10) {
                        return false;
                    }
                }
            }
            
            // Size filter
            if (currentFilters.size !== 'all') {
                if (currentFilters.size === 'large' && vessel.length < 200) return false;
                if (currentFilters.size === 'medium' && (vessel.length < 100 || vessel.length >= 200)) return false;
            }
            
            return true;
        }
        
        // Update vessel marker
        function updateVessel(mmsi, vessel) {
            if (!vessel.lat || !vessel.lon) return;
            
            // Check if vessel passes filters
            if (!passesFilters(vessel)) {
                // Remove marker if it exists
                if (markers[mmsi]) {
                    map.removeLayer(markers[mmsi]);
                    delete markers[mmsi];
                }
                return;
            }
            
            if (markers[mmsi]) {
                // Update existing marker
                markers[mmsi].setLatLng([vessel.lat, vessel.lon]);
                markers[mmsi].setPopupContent(createPopupContent(mmsi, vessel));
            } else {
                // Create new marker
                const marker = L.marker([vessel.lat, vessel.lon], {
                    icon: createVesselIcon(vessel)
                }).addTo(map);
                
                marker.bindPopup(createPopupContent(mmsi, vessel));
                
                // Add click handler to show sidebar and route
                marker.on('click', () => {
                    showVesselDetails(mmsi, vessel);
                    showVesselRoute(mmsi, vessel.name);
                });
                
                markers[mmsi] = marker;
            }
            
            // Update stats
            updateStats();
        }
        
        // Apply filters to all vessels
        function applyFilters() {
            // Clear all markers
            Object.values(markers).forEach(marker => map.removeLayer(marker));
            Object.keys(markers).forEach(key => delete markers[key]);
            
            // Re-add vessels that pass filters
            allVessels.forEach(vessel => {
                if (vessel.lat && vessel.lon) {
                    updateVessel(vessel.mmsi, vessel);
                }
            });
        }
        
        // Update statistics
        function updateStats() {
            document.getElementById('active-vessels').textContent = Object.keys(markers).length;
        }
        
        // Show vessel details in sidebar
        function showVesselDetails(mmsi, vessel) {
            const sidebar = document.getElementById('sidebar');
            const title = document.getElementById('sidebar-title');
            const content = document.getElementById('sidebar-content');
            
            title.textContent = vessel.name || 'Unknown Vessel';
            
            const typeInfo = getShipTypeInfo(vessel.ship_type);
            const hasPosition = vessel.lat !== undefined;
            
            content.innerHTML = `
                <div class="info-section">
                    <h3>üìã Basic Information</h3>
                    <div class="info-row">
                        <span class="info-label">MMSI</span>
                        <span class="info-value">${mmsi}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Vessel Name</span>
                        <span class="info-value">${vessel.name || 'Unknown'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Flag State</span>
                        <span class="info-value">${vessel.flag_state || 'Unknown'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ship Type</span>
                        <span class="info-value">${typeInfo.name} (${vessel.ship_type || 'N/A'})</span>
                    </div>
                    ${vessel.signatory_company ? `
                    <div class="info-row">
                        <span class="info-label">Company</span>
                        <span class="info-value">${vessel.signatory_company}</span>
                    </div>
                    ` : ''}
                </div>
                
                <div class="info-section">
                    <h3>üìè Dimensions</h3>
                    <div class="info-row">
                        <span class="info-label">Length</span>
                        <span class="info-value">${vessel.length || 'N/A'}m</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Beam</span>
                        <span class="info-value">${vessel.beam || 'N/A'}m</span>
                    </div>
                    ${vessel.imo ? `
                    <div class="info-row">
                        <span class="info-label">IMO Number</span>
                        <span class="info-value">${vessel.imo}</span>
                    </div>
                    ` : ''}
                    ${vessel.call_sign ? `
                    <div class="info-row">
                        <span class="info-label">Call Sign</span>
                        <span class="info-value">${vessel.call_sign}</span>
                    </div>
                    ` : ''}
                </div>
                
                ${hasPosition ? `
                <div class="info-section">
                    <h3>üìç Current Position</h3>
                    <div class="info-row">
                        <span class="info-label">Latitude</span>
                        <span class="info-value">${vessel.lat.toFixed(6)}¬∞</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Longitude</span>
                        <span class="info-value">${vessel.lon.toFixed(6)}¬∞</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Speed</span>
                        <span class="info-value">${vessel.sog || 0} knots</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Course</span>
                        <span class="info-value">${vessel.cog || 0}¬∞</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Last Update</span>
                        <span class="info-value">${new Date(vessel.timestamp).toLocaleString()}</span>
                    </div>
                </div>
                ` : '<div class="info-section"><em>Waiting for position data...</em></div>'}
                
                <div class="info-section">
                    <h3>üîó External Links</h3>
                    <a href="https://www.marinetraffic.com/en/ais/details/ships/mmsi:${mmsi}" target="_blank" style="color: #00d4ff; display: block; margin: 10px 0;">View on MarineTraffic ‚Üí</a>
                    <a href="https://www.vesselfinder.com/vessels?name=${encodeURIComponent(vessel.name || '')}" target="_blank" style="color: #00d4ff; display: block; margin: 10px 0;">Search on VesselFinder ‚Üí</a>
                </div>
            `;
            
            sidebar.classList.add('active');
        }
        
        // Close sidebar
        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('active');
        }
        
        // Show vessel route
        function showVesselRoute(mmsi, vesselName) {
            // Remove existing route
            if (currentRoute) {
                map.removeLayer(currentRoute);
                currentRoute = null;
            }
            
            // Fetch route data
            fetch(`/ships/api/vessel/${mmsi}/route?hours=24`)
                .then(response => response.json())
                .then(route => {
                    if (route.length === 0) {
                        alert(`No route data available for ${vesselName}.\n\nThis vessel may not have been tracked yet, or has no position history in the last 24 hours.`);
                        console.log('No route data available for this vessel');
                        return;
                    }
                    
                    // Create polyline from route points
                    const latLngs = route.map(p => [p.lat, p.lon]);
                    currentRoute = L.polyline(latLngs, {
                        color: '#ffff00',  // Bright yellow for visibility
                        weight: 4,
                        opacity: 0.9,
                        dashArray: '10, 5'
                    }).addTo(map);
                    
                    // Add start marker (green)
                    const startMarker = L.circleMarker([route[0].lat, route[0].lon], {
                        radius: 8,
                        fillColor: '#00ff00',
                        color: '#fff',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.9
                    }).addTo(map);
                    startMarker.bindPopup(`
                        <b>${vesselName}</b><br>
                        <b style="color: #00ff00;">üü¢ Start Position</b><br>
                        üìç ${route[0].lat.toFixed(4)}¬∞N, ${route[0].lon.toFixed(4)}¬∞E<br>
                        üö¢ Speed: ${route[0].sog || 0} knots<br>
                        üß≠ Course: ${route[0].cog || 0}¬∞<br>
                        üïê ${new Date(route[0].timestamp).toLocaleString()}
                    `);
                    
                    // Add end marker (red)
                    const endMarker = L.circleMarker([route[route.length-1].lat, route[route.length-1].lon], {
                        radius: 8,
                        fillColor: '#ff0000',
                        color: '#fff',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.9
                    }).addTo(map);
                    endMarker.bindPopup(`
                        <b>${vesselName}</b><br>
                        <b style="color: #ff0000;">üî¥ Current Position</b><br>
                        üìç ${route[route.length-1].lat.toFixed(4)}¬∞N, ${route[route.length-1].lon.toFixed(4)}¬∞E<br>
                        üö¢ Speed: ${route[route.length-1].sog || 0} knots<br>
                        üß≠ Course: ${route[route.length-1].cog || 0}¬∞<br>
                        üïê ${new Date(route[route.length-1].timestamp).toLocaleString()}
                    `);
                    
                    // Add popup to route
                    const duration = new Date(route[route.length-1].timestamp) - new Date(route[0].timestamp);
                    const hours = Math.floor(duration / (1000 * 60 * 60));
                    currentRoute.bindPopup(`
                        <b>${vesselName}</b><br>
                        <b>Route (last 24 hours)</b><br>
                        üìç ${route.length} positions<br>
                        ‚è±Ô∏è ${hours} hours tracked<br>
                        <span style="color: #00ff00;">‚óè</span> Green = Start<br>
                        <span style="color: #ff0000;">‚óè</span> Red = Current
                    `);
                    
                    // Fit map to route
                    map.fitBounds(currentRoute.getBounds().pad(0.1));
                    
                    // Show success message
                    console.log(`Route loaded: ${route.length} positions over ${hours} hours`);
                })
                .catch(error => {
                    console.error('Error fetching route:', error);
                    alert(`Error loading route for ${vesselName}.\n\nPlease try again later.`);
                });
        }
        
        // Load initial data
        fetch('/ships/api/vessels')
            .then(response => response.json())
            .then(vessels => {
                allVessels = vessels;
                document.getElementById('total-vessels').textContent = vessels.length;
                
                vessels.forEach(vessel => {
                    if (vessel.lat && vessel.lon) {
                        updateVessel(vessel.mmsi, vessel);
                    }
                });
                
                // Check if MMSI is in URL to show specific route
                const urlParams = new URLSearchParams(window.location.search);
                const mmsi = urlParams.get('mmsi');
                if (mmsi) {
                    const vessel = vessels.find(v => v.mmsi == mmsi);
                    if (vessel) {
                        showVesselRoute(parseInt(mmsi), vessel.name);
                    }
                } else {
                    // Fit map to show all vessels
                    if (Object.keys(markers).length > 0) {
                        const group = L.featureGroup(Object.values(markers));
                        map.fitBounds(group.getBounds().pad(0.1));
                    }
                }
            });
        
        // Connect to WebSocket for live updates
        const socket = io({path: '/ships/socket.io'});
        
        socket.on('connect', () => {
            console.log('Connected to server');
        });
        
        socket.on('vessel_update', (data) => {
            // Update vessel in allVessels array
            const index = allVessels.findIndex(v => v.mmsi === data.mmsi);
            if (index >= 0) {
                allVessels[index] = {...allVessels[index], ...data.position};
            } else {
                allVessels.push({mmsi: data.mmsi, ...data.position});
            }
            updateVessel(data.mmsi, data.position);
        });
        
        socket.on('initial_data', (data) => {
            console.log('Received initial data:', data);
        });
        
        // Filter event listeners
        document.getElementById('filter-type').addEventListener('change', (e) => {
            currentFilters.type = e.target.value;
            applyFilters();
        });
        
        document.getElementById('filter-size').addEventListener('change', (e) => {
            currentFilters.size = e.target.value;
            applyFilters();
        });
        
        // Refresh stats every 5 seconds
        setInterval(() => {
            fetch('/ships/api/stats')
                .then(response => response.json())
                .then(stats => {
                    document.getElementById('total-vessels').textContent = stats.total_vessels;
                });
        }, 5000);
    </script>
</body>
</html>
